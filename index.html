<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rhythm Battle Arena</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: #0a0e27;
  color: white;
  overflow: hidden;
}

/* Background */
.bg-gradient {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at 20% 50%, rgba(131, 56, 236, 0.2) 0%, transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(255, 0, 110, 0.2) 0%, transparent 50%);
  z-index: -1;
}

/* Screens */
.screen {
  display: none;
  width: 100vw;
  height: 100vh;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.screen.active {
  display: flex;
}

/* Title Screen */
.title {
  font-size: 72px;
  font-weight: 800;
  background: linear-gradient(45deg, #ff006e, #8338ec);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.subtitle {
  font-size: 24px;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 50px;
}

.press-start {
  font-size: 20px;
  color: #fb5607;
  animation: blink 1.5s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* Menu Cards */
.menu-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 30px;
  max-width: 900px;
}

.menu-card {
  width: 250px;
  height: 150px;
  background: linear-gradient(135deg, rgba(131, 56, 236, 0.2), rgba(255, 0, 110, 0.2));
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: all 0.3s;
}

.menu-card.selected {
  transform: scale(1.1);
  border-color: #ff006e;
  box-shadow: 0 0 30px rgba(255, 0, 110, 0.5);
}

.card-icon {
  font-size: 48px;
  margin-bottom: 10px;
}

.card-title {
  font-size: 22px;
  font-weight: 600;
}

/* Song List */
.song-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 600px;
}

.song-item {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 25px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s;
}

.song-item.selected {
  background: linear-gradient(90deg, rgba(131, 56, 236, 0.3), rgba(255, 0, 110, 0.3));
  border-color: #ff006e;
  transform: translateX(10px);
}

.song-name {
  font-size: 26px;
  font-weight: 600;
}

.difficulty {
  color: #ffbe0b;
  font-size: 18px;
}

/* Game Canvas */
#gameScreen {
  background: #0a0e27;
  position: relative;
}

#gameCanvas {
  display: block;
  margin: 0 auto;
  background: linear-gradient(180deg, #0a0e27 0%, #1a0e3f 100%);
}

.game-hud {
  position: absolute;
  top: 20px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  padding: 0 40px;
  font-size: 28px;
  font-weight: 600;
  pointer-events: none;
}

.score {
  color: #fb5607;
}

.combo-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 64px;
  font-weight: 800;
  color: #06ffa5;
  text-shadow: 0 0 20px #06ffa5;
  display: none;
}

.combo-text.show {
  display: block;
}

/* Results */
.results-box {
  background: rgba(10, 14, 39, 0.95);
  border: 3px solid #ff006e;
  border-radius: 30px;
  padding: 50px;
  text-align: center;
  min-width: 500px;
}

.rank {
  font-size: 120px;
  font-weight: 800;
  margin: 20px 0;
}

.rank-S { color: #ffbe0b; text-shadow: 0 0 30px #ffbe0b; }
.rank-A { color: #06ffa5; text-shadow: 0 0 30px #06ffa5; }
.rank-B { color: #3a86ff; text-shadow: 0 0 30px #3a86ff; }
.rank-C { color: #8338ec; text-shadow: 0 0 30px #8338ec; }
.rank-D { color: #ff006e; text-shadow: 0 0 30px #ff006e; }

.stat-row {
  display: flex;
  justify-content: space-around;
  margin: 30px 0;
  gap: 20px;
}

.stat {
  flex: 1;
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 15px;
}

.stat-label {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 5px;
}

.stat-value {
  font-size: 32px;
  font-weight: 600;
}

.btn {
  margin-top: 30px;
  padding: 15px 50px;
  background: linear-gradient(90deg, #ff006e, #8338ec);
  border: none;
  border-radius: 50px;
  font-size: 20px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  font-family: 'Poppins', sans-serif;
}

.btn:hover {
  transform: scale(1.05);
}

@media (max-width: 768px) {
  .title { font-size: 48px; }
  .menu-grid { grid-template-columns: 1fr; }
  .song-list { width: 90%; }
}
</style>
</head>

<body>

<div class="bg-gradient"></div>

<!-- TITLE SCREEN -->
<div id="titleScreen" class="screen active">
  <div class="title">RHYTHM BATTLE</div>
  <div class="subtitle">ARENA</div>
  <div class="press-start">PRESIONA ENTER</div>
</div>

<!-- MAIN MENU -->
<div id="mainMenu" class="screen">
  <div class="title" style="font-size: 56px; margin-bottom: 50px;">MEN√ö PRINCIPAL</div>
  <div class="menu-grid">
    <div class="menu-card selected">
      <div class="card-icon">üéÆ</div>
      <div class="card-title">JUGAR</div>
    </div>
    <div class="menu-card">
      <div class="card-icon">üéµ</div>
      <div class="card-title">CANCIONES</div>
    </div>
    <div class="menu-card">
      <div class="card-icon">‚öôÔ∏è</div>
      <div class="card-title">OPCIONES</div>
    </div>
  </div>
</div>

<!-- SONG SELECT -->
<div id="songSelect" class="screen">
  <div class="title" style="font-size: 48px; margin-bottom: 40px;">ELIGE CANCI√ìN</div>
  <div class="song-list">
    <div class="song-item selected" data-song="0">
      <div class="song-name">üéπ Tutorial Beat</div>
      <div class="difficulty">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</div>
    </div>
    <div class="song-item" data-song="1">
      <div class="song-name">‚ö° Battle Mode</div>
      <div class="difficulty">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</div>
    </div>
    <div class="song-item" data-song="2">
      <div class="song-name">üî• Epic Rush</div>
      <div class="difficulty">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
    </div>
  </div>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="screen">
  <div class="game-hud">
    <div class="score">Score: <span id="scoreValue">0</span></div>
    <div style="color: rgba(255,255,255,0.6);">ESC = Pausa</div>
  </div>
  <div class="combo-text" id="comboText">0x</div>
  <canvas id="gameCanvas"></canvas>
</div>

<!-- RESULTS -->
<div id="resultsScreen" class="screen">
  <div class="results-box">
    <div class="title" style="font-size: 42px;">¬°COMPLETADO!</div>
    <div class="rank rank-S" id="rankText">S</div>
    
    <div class="stat-row">
      <div class="stat">
        <div class="stat-label">PUNTUACI√ìN</div>
        <div class="stat-value" id="finalScore">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">PRECISI√ìN</div>
        <div class="stat-value" id="finalAccuracy">0%</div>
      </div>
    </div>
    
    <div class="stat-row">
      <div class="stat">
        <div class="stat-label">MAX COMBO</div>
        <div class="stat-value" id="finalCombo">0</div>
      </div>
      <div class="stat">
        <div class="stat-label">PERFECTS</div>
        <div class="stat-value" id="finalPerfects">0</div>
      </div>
    </div>
    
    <button class="btn" onclick="backToMenu()">CONTINUAR</button>
  </div>
</div>

<script>
// Global state
let currentScreen = 'titleScreen';
let menuIndex = 0;
let songIndex = 0;

// Game state
const game = {
  canvas: null,
  ctx: null,
  running: false,
  notes: [],
  score: 0,
  combo: 0,
  maxCombo: 0,
  health: 50,
  stats: { perfect: 0, good: 0, bad: 0, miss: 0 },
  keys: ['ArrowLeft', 'ArrowDown', 'ArrowUp', 'ArrowRight'],
  colors: ['#ff006e', '#00f5ff', '#06ffa5', '#ffbe0b'],
  icons: ['‚Üê', '‚Üì', '‚Üë', '‚Üí'],
  laneX: [],
  hitLineY: 0,
  chartIndex: 0,
  currentChart: [],
  keysPressed: new Set()
};

// Charts
const charts = [
  // Tutorial
  [
    {time: 1000, dir: 0}, {time: 1500, dir: 1}, {time: 2000, dir: 2}, {time: 2500, dir: 3},
    {time: 3000, dir: 0}, {time: 3500, dir: 1}, {time: 4000, dir: 2}, {time: 4500, dir: 3},
    {time: 5000, dir: 1}, {time: 5500, dir: 2}, {time: 6000, dir: 1}, {time: 6500, dir: 2},
    {time: 7000, dir: 0}, {time: 7500, dir: 3}, {time: 8000, dir: 0}, {time: 8500, dir: 3}
  ],
  // Battle
  [
    {time: 500, dir: 0}, {time: 750, dir: 1}, {time: 1000, dir: 2}, {time: 1250, dir: 3},
    {time: 1500, dir: 0}, {time: 1750, dir: 2}, {time: 2000, dir: 1}, {time: 2250, dir: 3},
    {time: 2500, dir: 0}, {time: 2750, dir: 1}, {time: 3000, dir: 2}, {time: 3250, dir: 3},
    {time: 3500, dir: 1}, {time: 3750, dir: 2}, {time: 4000, dir: 1}, {time: 4250, dir: 3}
  ],
  // Epic
  [
    {time: 400, dir: 0}, {time: 600, dir: 1}, {time: 800, dir: 2}, {time: 1000, dir: 3},
    {time: 1200, dir: 0}, {time: 1400, dir: 1}, {time: 1600, dir: 2}, {time: 1800, dir: 3},
    {time: 2000, dir: 1}, {time: 2200, dir: 2}, {time: 2400, dir: 1}, {time: 2600, dir: 3},
    {time: 2800, dir: 0}, {time: 3000, dir: 2}, {time: 3200, dir: 0}, {time: 3400, dir: 3}
  ]
];

// Initialize
function init() {
  game.canvas = document.getElementById('gameCanvas');
  game.ctx = game.canvas.getContext('2d');
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
}

function resizeCanvas() {
  const width = Math.min(window.innerWidth * 0.8, 800);
  const height = Math.min(window.innerHeight * 0.7, 600);
  
  game.canvas.width = width;
  game.canvas.height = height;
  
  const laneWidth = width / 5;
  game.laneX = [laneWidth, laneWidth * 2, laneWidth * 3, laneWidth * 4];
  game.hitLineY = height * 0.8;
}

// Screen management
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(name).classList.add('active');
  currentScreen = name;
}

// Keyboard
document.addEventListener('keydown', (e) => {
  if (game.keys.includes(e.key)) {
    e.preventDefault();
  }
  
  // Title
  if (currentScreen === 'titleScreen' && e.key === 'Enter') {
    showScreen('mainMenu');
    return;
  }
  
  // Main menu
  if (currentScreen === 'mainMenu') {
    const cards = document.querySelectorAll('.menu-card');
    
    if (e.key === 'ArrowLeft') {
      menuIndex = Math.max(0, menuIndex - 1);
    } else if (e.key === 'ArrowRight') {
      menuIndex = Math.min(2, menuIndex + 1);
    } else if (e.key === 'Enter') {
      if (menuIndex === 0 || menuIndex === 1) {
        showScreen('songSelect');
      }
      return;
    }
    
    cards.forEach((c, i) => c.classList.toggle('selected', i === menuIndex));
    return;
  }
  
  // Song select
  if (currentScreen === 'songSelect') {
    const songs = document.querySelectorAll('.song-item');
    
    if (e.key === 'ArrowUp') {
      songIndex = Math.max(0, songIndex - 1);
    } else if (e.key === 'ArrowDown') {
      songIndex = Math.min(2, songIndex + 1);
    } else if (e.key === 'Enter') {
      startGame(songIndex);
      return;
    } else if (e.key === 'Escape') {
      showScreen('mainMenu');
      return;
    }
    
    songs.forEach((s, i) => s.classList.toggle('selected', i === songIndex));
    return;
  }
  
  // Game
  if (currentScreen === 'gameScreen') {
    if (e.key === 'Escape') {
      endGame();
      return;
    }
    
    if (!game.keysPressed.has(e.key)) {
      game.keysPressed.add(e.key);
      handleGameInput(e.key);
    }
  }
});

document.addEventListener('keyup', (e) => {
  game.keysPressed.delete(e.key);
});

// Game functions
function startGame(chartIndex) {
  game.notes = [];
  game.score = 0;
  game.combo = 0;
  game.maxCombo = 0;
  game.health = 50;
  game.stats = { perfect: 0, good: 0, bad: 0, miss: 0 };
  game.chartIndex = 0;
  game.currentChart = charts[chartIndex];
  game.running = true;
  game.startTime = performance.now();
  game.keysPressed.clear();
  
  document.getElementById('scoreValue').textContent = '0';
  document.getElementById('comboText').classList.remove('show');
  
  showScreen('gameScreen');
  gameLoop();
}

function handleGameInput(key) {
  const keyIndex = game.keys.indexOf(key);
  if (keyIndex === -1) return;
  
  let closest = null;
  let closestDist = Infinity;
  let closestIdx = -1;
  
  for (let i = 0; i < game.notes.length; i++) {
    const note = game.notes[i];
    const dist = Math.abs(note.y - game.hitLineY);
    
    if (note.dir === keyIndex && dist < 60 && dist < closestDist) {
      closest = note;
      closestDist = dist;
      closestIdx = i;
    }
  }
  
  if (closest) {
    game.notes.splice(closestIdx, 1);
    
    if (closestDist < 20) {
      game.score += 500;
      game.combo++;
      game.health = Math.min(100, game.health + 3);
      game.stats.perfect++;
    } else if (closestDist < 40) {
      game.score += 300;
      game.combo++;
      game.health = Math.min(100, game.health + 2);
      game.stats.good++;
    } else {
      game.score += 100;
      game.combo++;
      game.health = Math.min(100, game.health + 1);
      game.stats.bad++;
    }
    
    game.maxCombo = Math.max(game.maxCombo, game.combo);
    document.getElementById('scoreValue').textContent = game.score;
    
    if (game.combo > 5) {
      document.getElementById('comboText').textContent = game.combo + 'x';
      document.getElementById('comboText').classList.add('show');
    }
  } else {
    game.score = Math.max(0, game.score - 20);
  }
}

function gameLoop() {
  if (!game.running) return;
  
  const now = performance.now();
  const elapsed = now - game.startTime;
  
  // Spawn notes
  while (game.chartIndex < game.currentChart.length && 
         elapsed >= game.currentChart[game.chartIndex].time) {
    const note = game.currentChart[game.chartIndex];
    game.notes.push({
      dir: note.dir,
      x: game.laneX[note.dir],
      y: -30
    });
    game.chartIndex++;
  }
  
  // Clear
  game.ctx.fillStyle = '#0a0e27';
  game.ctx.fillRect(0, 0, game.canvas.width, game.canvas.height);
  
  // Draw lanes
  game.laneX.forEach((x, i) => {
    game.ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
    game.ctx.lineWidth = 2;
    game.ctx.beginPath();
    game.ctx.moveTo(x, 0);
    game.ctx.lineTo(x, game.canvas.height);
    game.ctx.stroke();
  });
  
  // Hit line
  game.ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
  game.ctx.lineWidth = 3;
  game.ctx.beginPath();
  game.ctx.moveTo(0, game.hitLineY);
  game.ctx.lineTo(game.canvas.width, game.hitLineY);
  game.ctx.stroke();
  
  // Update notes
  for (let i = game.notes.length - 1; i >= 0; i--) {
    const note = game.notes[i];
    note.y += 4;
    
    // Draw note
    game.ctx.fillStyle = game.colors[note.dir];
    game.ctx.beginPath();
    game.ctx.arc(note.x, note.y, 20, 0, Math.PI * 2);
    game.ctx.fill();
    
    game.ctx.fillStyle = '#000';
    game.ctx.font = 'bold 24px Arial';
    game.ctx.textAlign = 'center';
    game.ctx.textBaseline = 'middle';
    game.ctx.fillText(game.icons[note.dir], note.x, note.y);
    
    // Miss
    if (note.y > game.hitLineY + 60) {
      game.notes.splice(i, 1);
      game.combo = 0;
      game.health = Math.max(0, game.health - 5);
      game.stats.miss++;
      document.getElementById('comboText').classList.remove('show');
    }
  }
  
  // Draw receptors
  game.laneX.forEach((x, i) => {
    const pressed = game.keysPressed.has(game.keys[i]);
    
    game.ctx.fillStyle = pressed ? game.colors[i] : 'rgba(255, 255, 255, 0.1)';
    game.ctx.strokeStyle = game.colors[i];
    game.ctx.lineWidth = 3;
    
    game.ctx.beginPath();
    game.ctx.arc(x, game.hitLineY, 25, 0, Math.PI * 2);
    game.ctx.fill();
    game.ctx.stroke();
    
    game.ctx.fillStyle = pressed ? '#000' : game.colors[i];
    game.ctx.font = 'bold 28px Arial';
    game.ctx.textAlign = 'center';
    game.ctx.textBaseline = 'middle';
    game.ctx.fillText(game.icons[i], x, game.hitLineY);
  });
  
  // Health bar
  const barW = game.canvas.width - 40;
  const barH = 15;
  
  game.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
  game.ctx.fillRect(20, 20, barW, barH);
  
  const healthW = (game.health / 100) * barW;
  game.ctx.fillStyle = game.health > 60 ? '#06ffa5' : game.health > 30 ? '#ffbe0b' : '#ff006e';
  game.ctx.fillRect(20, 20, healthW, barH);
  
  game.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
  game.ctx.lineWidth = 2;
  game.ctx.strokeRect(20, 20, barW, barH);
  
  // Game over
  if (game.health <= 0 || (game.chartIndex >= game.currentChart.length && game.notes.length === 0)) {
    endGame();
    return;
  }
  
  requestAnimationFrame(gameLoop);
}

function endGame() {
  game.running = false;
  
  const total = game.stats.perfect + game.stats.good + game.stats.bad + game.stats.miss;
  const hits = game.stats.perfect + game.stats.good + game.stats.bad;
  const accuracy = total > 0 ? ((hits / total) * 100).toFixed(1) : 0;
  
  let rank = 'D';
  let rankClass = 'rank-D';
  
  if (accuracy >= 95) { rank = 'S'; rankClass = 'rank-S'; }
  else if (accuracy >= 90) { rank = 'A'; rankClass = 'rank-A'; }
  else if (accuracy >= 80) { rank = 'B'; rankClass = 'rank-B'; }
  else if (accuracy >= 70) { rank = 'C'; rankClass = 'rank-C'; }
  
  document.getElementById('rankText').textContent = rank;
  document.getElementById('rankText').className = 'rank ' + rankClass;
  document.getElementById('finalScore').textContent = game.score;
  document.getElementById('finalAccuracy').textContent = accuracy + '%';
  document.getElementById('finalCombo').textContent = game.maxCombo;
  document.getElementById('finalPerfects').textContent = game.stats.perfect;
  
  showScreen('resultsScreen');
}

function backToMenu() {
  showScreen('mainMenu');
  menuIndex = 0;
  document.querySelectorAll('.menu-card').forEach((c, i) => c.classList.toggle('selected', i === 0));
}

// Start
window.addEventListener('load', init);
</script>

</body>
</html>
